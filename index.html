<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diabetes Type Assessment | AI-Powered Medical Diagnosis</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --type1: #3498db;
            --type2: #e74c3c;
            --gestational: #9b59b6;
            --prediabetes: #f39c12;
            --lada: #1abc9c;
            --safe: #2ecc71;
            --critical: #e74c3c;
            --warning: #f39c12;
            --dark: #2c3e50;
            --light: #ecf0f1;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--dark), #34495e);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .progress-container {
            background: rgba(255,255,255,0.2);
            border-radius: 10px;
            height: 10px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-bar {
            height: 100%;
            background: var(--safe);
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Assessment Section */
        .assessment-section {
            padding: 40px;
            display: block;
        }

        .question-section {
            display: none;
        }

        .question-section.active {
            display: block;
        }

        .question-text {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 25px;
            color: var(--dark);
            line-height: 1.5;
        }

        .options-container {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-bottom: 30px;
        }

        .option {
            padding: 20px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
        }

        .option:hover {
            border-color: var(--type1);
            background: #e3f2fd;
        }

        .option.selected {
            border-color: var(--type1);
            background: #e3f2fd;
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.2);
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            gap: 15px;
        }

        .nav-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: var(--type1);
            color: white;
        }

        .btn-secondary {
            background: #e0e0e0;
            color: var(--dark);
        }

        /* Dashboard Section */
        .dashboard-section {
            padding: 30px;
            display: none;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 25px;
            margin-top: 20px;
        }

        .results-card {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 15px;
            border-left: 5px solid var(--type1);
        }

        .result-type {
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .result-confidence {
            font-size: 1.3rem;
            color: var(--dark);
            margin-bottom: 20px;
        }

        .percentage-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 25px 0;
        }

        .percentage-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            border-left: 4px solid;
        }

        .percentage-value {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }

        .symptoms-list {
            margin: 20px 0;
        }

        .symptom-item {
            padding: 10px;
            background: white;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
        }

        .symptom-present {
            color: var(--safe);
            font-weight: 600;
        }

        .symptom-absent {
            color: var(--critical);
        }

        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            height: 300px;
        }

        .risk-factors {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 15px;
        }

        .risk-item {
            padding: 15px;
            background: white;
            margin: 10px 0;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .risk-high { border-left: 4px solid var(--critical); }
        .risk-medium { border-left: 4px solid var(--warning); }
        .risk-low { border-left: 4px solid var(--safe); }

        .type1 { border-left-color: var(--type1); color: var(--type1); }
        .type2 { border-left-color: var(--type2); color: var(--type2); }
        .gestational { border-left-color: var(--gestational); color: var(--gestational); }
        .prediabetes { border-left-color: var(--prediabetes); color: var(--prediabetes); }
        .lada { border-left-color: var(--lada); color: var(--lada); }

        /* ML Status Section */
        .ml-status {
            background: #f1f8ff;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .ml-icon {
            font-size: 1.5rem;
        }

        .ml-text {
            flex: 1;
        }

        .ml-loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(52, 152, 219, 0.3);
            border-radius: 50%;
            border-top-color: var(--type1);
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Model Info Section */
        .model-info {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .model-details {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-top: 15px;
        }

        .model-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border-left: 4px solid var(--type1);
        }

        .model-name {
            font-weight: 600;
            margin-bottom: 5px;
        }

        .model-accuracy {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--type1);
        }

        /* ML Models Grid */
        .ml-models-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            margin-top: 30px;
        }

        .ml-category {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
        }

        .ml-category h3 {
            margin-bottom: 15px;
            color: var(--dark);
            border-bottom: 2px solid var(--type1);
            padding-bottom: 8px;
        }

        .model-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: white;
            margin: 8px 0;
            border-radius: 5px;
        }

        .model-name {
            font-weight: 600;
        }

        .model-percentage {
            font-weight: 700;
            font-size: 1.1rem;
        }

        .ensemble-result {
            background: linear-gradient(135deg, var(--type1), #2980b9);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            text-align: center;
        }

        .ensemble-percentage {
            font-size: 2rem;
            font-weight: 700;
            margin: 10px 0;
        }

        /* LLM Analysis Section */
        .llm-analysis {
            background: #f0f7ff;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .llm-response {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-top: 10px;
            font-style: italic;
            border-left: 4px solid #3498db;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <h1>Diabetes Type Assessment</h1>
            <p>AI-Powered Diagnosis Using Multiple Machine Learning Models and LLMs</p>
            <div class="progress-container">
                <div class="progress-bar" id="progressBar"></div>
            </div>
            <div id="progressText">Question 1 of 10</div>
        </div>

        <!-- Assessment Section -->
        <div class="assessment-section" id="assessmentSection">
            <!-- Question 1: Age -->
            <div class="question-section active" id="question1">
                <div class="question-text">How old are you currently?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="age" value="under25"> Under 25 years
                    </label>
                    <label class="option">
                        <input type="radio" name="age" value="25_40"> 25 - 40 years
                    </label>
                    <label class="option">
                        <input type="radio" name="age" value="40_60"> 40 - 60 years
                    </label>
                    <label class="option">
                        <input type="radio" name="age" value="over60"> Over 60 years
                    </label>
                    <label class="option">
                        <input type="radio" name="age" value="pregnant"> I'm currently pregnant
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()" disabled>Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 2: Symptom Onset -->
            <div class="question-section" id="question2">
                <div class="question-text">When did you first notice changes in your health?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="onset" value="recent_rapid"> Recently, came on very quickly (days/weeks)
                    </label>
                    <label class="option">
                        <input type="radio" name="onset" value="recent_gradual"> Recently, developed slowly (months)
                    </label>
                    <label class="option">
                        <input type="radio" name="onset" value="long_gradual"> Over the past few years gradually
                    </label>
                    <label class="option">
                        <input type="radio" name="onset" value="during_pregnancy"> Started during pregnancy
                    </label>
                    <label class="option">
                        <input type="radio" name="onset" value="no_changes"> Haven't noticed any changes
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 3: Thirst & Urination -->
            <div class="question-section" id="question3">
                <div class="question-text">Have you been feeling unusually thirsty or needing to urinate more often?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="thirst" value="extreme"> Yes, extremely thirsty and bathroom trips
                    </label>
                    <label class="option">
                        <input type="radio" name="thirst" value="moderate"> Yes, somewhat more than usual
                    </label>
                    <label class="option">
                        <input type="radio" name="thirst" value="mild"> A little bit, but not too noticeable
                    </label>
                    <label class="option">
                        <input type="radio" name="thirst" value="pregnancy_related"> More during pregnancy
                    </label>
                    <label class="option">
                        <input type="radio" name="thirst" value="none"> No changes in thirst or urination
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 4: Energy Levels -->
            <div class="question-section" id="question4">
                <div class="question-text">How have your energy levels been feeling lately?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="energy" value="very_low"> Constantly tired and drained
                    </label>
                    <label class="option">
                        <input type="radio" name="energy" value="low_after_meals"> Tired especially after eating
                    </label>
                    <label class="option">
                        <input type="radio" name="energy" value="moderate_low"> More tired than usual
                    </label>
                    <label class="option">
                        <input type="radio" name="energy" value="pregnancy_tired"> Pregnancy-related fatigue
                    </label>
                    <label class="option">
                        <input type="radio" name="energy" value="normal"> Energy levels feel normal
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 5: Weight Changes -->
            <div class="question-section" id="question5">
                <div class="question-text">Have you noticed any changes in your weight recently?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="weight" value="rapid_loss"> Lost weight quickly without trying
                    </label>
                    <label class="option">
                        <input type="radio" name="weight" value="gradual_gain"> Gaining weight gradually over time
                    </label>
                    <label class="option">
                        <input type="radio" name="weight" value="stable"> Weight has stayed about the same
                    </label>
                    <label class="option">
                        <input type="radio" name="weight" value="pregnancy_gain"> Normal pregnancy weight gain
                    </label>
                    <label class="option">
                        <input type="radio" name="weight" value="fluctuating"> Weight goes up and down
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 6: Sleep Quality -->
            <div class="question-section" id="question6">
                <div class="question-text">How would you describe your sleep quality recently?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="sleep" value="wake_bathroom"> Wake up multiple times for bathroom
                    </label>
                    <label class="option">
                        <input type="radio" name="sleep" value="restless_thirst"> Restless, wake up thirsty
                    </label>
                    <label class="option">
                        <input type="radio" name="sleep" value="tired_morning"> Sleep through night but wake up tired
                    </label>
                    <label class="option">
                        <input type="radio" name="sleep" value="pregnancy_sleep"> Pregnancy affecting sleep
                    </label>
                    <label class="option">
                        <input type="radio" name="sleep" value="good_sleep"> Sleep well and feel rested
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 7: Vision Changes -->
            <div class="question-section" id="question7">
                <div class="question-text">Have you noticed any changes in your vision?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="vision" value="blurred_fluctuating"> Vision gets blurry sometimes
                    </label>
                    <label class="option">
                        <input type="radio" name="vision" value="blurred_constant"> Constantly blurry vision
                    </label>
                    <label class="option">
                        <input type="radio" name="vision" value="pregnancy_vision"> Vision changes during pregnancy
                    </label>
                    <label class="option">
                        <input type="radio" name="vision" value="minor_changes"> Minor changes, not concerning
                    </label>
                    <label class="option">
                        <input type="radio" name="vision" value="no_changes"> No changes in vision
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 8: Family History -->
            <div class="question-section" id="question8">
                <div class="question-text">Does diabetes run in your family?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="family" value="parents_siblings"> Parents or siblings have diabetes
                    </label>
                    <label class="option">
                        <input type="radio" name="family" value="grandparents"> Grandparents have diabetes
                    </label>
                    <label class="option">
                        <input type="radio" name="family" value="gestational_family"> Family history of gestational diabetes
                    </label>
                    <label class="option">
                        <input type="radio" name="family" value="distant"> Distant relatives only
                    </label>
                    <label class="option">
                        <input type="radio" name="family" value="none"> No family history of diabetes
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 9: Hunger & Cravings -->
            <div class="question-section" id="question9">
                <div class="question-text">How has your appetite been recently?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="hunger" value="always_hungry"> Always hungry even after eating
                    </label>
                    <label class="option">
                        <input type="radio" name="hunger" value="sugar_cravings"> Strong cravings for sugary foods
                    </label>
                    <label class="option">
                        <input type="radio" name="hunger" value="normal_appetite"> Normal appetite, no changes
                    </label>
                    <label class="option">
                        <input type="radio" name="hunger" value="pregnancy_appetite"> Pregnancy-related appetite changes
                    </label>
                    <label class="option">
                        <input type="radio" name="hunger" value="reduced_appetite"> Less hungry than usual
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="nextQuestion()">Next</button>
                </div>
            </div>

            <!-- Question 10: Other Symptoms -->
            <div class="question-section" id="question10">
                <div class="question-text">Have you experienced any of these other symptoms?</div>
                <div class="options-container">
                    <label class="option">
                        <input type="radio" name="other" value="skin_infections"> Frequent skin infections or slow healing
                    </label>
                    <label class="option">
                        <input type="radio" name="other" value="tingling_feet"> Tingling or numbness in hands/feet
                    </label>
                    <label class="option">
                        <input type="radio" name="other" value="nausea_vomiting"> Nausea or vomiting
                    </label>
                    <label class="option">
                        <input type="radio" name="other" value="pregnancy_symptoms"> Pregnancy-related symptoms only
                    </label>
                    <label class="option">
                        <input type="radio" name="other" value="none"> None of these symptoms
                    </label>
                </div>
                <div class="nav-buttons">
                    <button class="nav-btn btn-secondary" onclick="previousQuestion()">Previous</button>
                    <button class="nav-btn btn-primary" onclick="showResults()">See My Results</button>
                </div>
            </div>
        </div>

        <!-- Dashboard Section -->
        <div class="dashboard-section" id="dashboardSection">
            <h2 style="text-align: center; margin-bottom: 30px; color: var(--dark);">Your Diabetes Assessment Results</h2>
            
            <!-- ML Status Indicator -->
            <div class="ml-status" id="mlStatus">
                <div class="ml-icon">🤖</div>
                <div class="ml-text">
                    <strong>Multi-Model AI Analysis in Progress</strong>
                    <p>Our ensemble of 12 ML models and 8 LLMs is analyzing your responses for maximum accuracy</p>
                </div>
                <div class="ml-loading" id="mlLoading"></div>
            </div>
            
            <div class="dashboard-grid">
                <!-- Left Column: Results & Symptoms -->
                <div>
                    <div class="results-card" id="primaryResult">
                        <div class="result-type" id="diagnosisType">Analyzing Your Results...</div>
                        <div class="result-confidence" id="confidenceLevel">Calculating probabilities...</div>
                        
                        <!-- Percentage Grid -->
                        <div class="percentage-grid">
                            <div class="percentage-card type1">
                                <div>Type 1 Diabetes</div>
                                <div class="percentage-value" id="type1Percent">0%</div>
                                <div>Probability</div>
                            </div>
                            <div class="percentage-card type2">
                                <div>Type 2 Diabetes</div>
                                <div class="percentage-value" id="type2Percent">0%</div>
                                <div>Probability</div>
                            </div>
                            <div class="percentage-card gestational">
                                <div>Gestational Diabetes</div>
                                <div class="percentage-value" id="gestationalPercent">0%</div>
                                <div>Probability</div>
                            </div>
                            <div class="percentage-card prediabetes">
                                <div>Pre-diabetes</div>
                                <div class="percentage-value" id="prediabetesPercent">0%</div>
                                <div>Probability</div>
                            </div>
                            <div class="percentage-card lada">
                                <div>LADA Diabetes</div>
                                <div class="percentage-value" id="ladaPercent">0%</div>
                                <div>Probability</div>
                            </div>
                        </div>

                        <div class="symptoms-list">
                            <h3>Your Reported Symptoms</h3>
                            <div id="symptomsAnalysis">
                                <!-- Symptoms will be populated here -->
                            </div>
                        </div>

                        <div style="margin-top: 25px;">
                            <h3>Recommended Next Steps</h3>
                            <div id="recommendations">
                                <!-- Recommendations will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Right Column: Charts & Risks -->
                <div>
                    <div class="chart-container">
                        <canvas id="probabilityChart"></canvas>
                    </div>
                    
                    <div class="risk-factors">
                        <h3>Your Risk Factors</h3>
                        <div id="riskFactors">
                            <!-- Risk factors will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- ML Models Analysis -->
            <div class="ml-models-grid">
                <!-- Traditional ML Models -->
                <div class="ml-category">
                    <h3>Traditional Machine Learning Models</h3>
                    <div id="mlModelsList">
                        <!-- ML models will be populated here -->
                    </div>
                    <div class="ensemble-result">
                        <div>Ensemble ML Result</div>
                        <div class="ensemble-percentage" id="mlEnsembleResult">0%</div>
                        <div>Weighted Average</div>
                    </div>
                </div>

                <!-- LLM Models -->
                <div class="ml-category">
                    <h3>Large Language Models</h3>
                    <div id="llmModelsList">
                        <!-- LLM models will be populated here -->
                    </div>
                    <div class="ensemble-result">
                        <div>Ensemble LLM Result</div>
                        <div class="ensemble-percentage" id="llmEnsembleResult">0%</div>
                        <div>Confidence Score</div>
                    </div>
                </div>
            </div>

            <!-- LLM Analysis Section -->
            <div class="llm-analysis">
                <h3>LLM Clinical Analysis</h3>
                <div id="llmClinicalAnalysis">
                    <!-- LLM analysis will be populated here -->
                </div>
            </div>

            <!-- Final Ensemble Result -->
            <div class="ensemble-result" style="margin-top: 30px;">
                <div>Final Ensemble Diagnosis</div>
                <div class="ensemble-percentage" id="finalEnsembleResult">0%</div>
                <div>Combined ML + LLM Analysis</div>
            </div>

            <div style="text-align: center; margin-top: 30px;">
                <button class="nav-btn btn-primary" onclick="restartAssessment()">Start New Assessment</button>
            </div>
        </div>
    </div>

    <script>
        let currentQuestion = 1;
        const totalQuestions = 10;
        const userResponses = {};
        let probabilityChart;

        // Initialize option selection
        document.querySelectorAll('.option').forEach(option => {
            option.addEventListener('click', function() {
                const radio = this.querySelector('input[type="radio"]');
                radio.checked = true;
                
                // Update visual selection
                this.parentElement.querySelectorAll('.option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
            });
        });

        function updateProgress() {
            const progress = ((currentQuestion - 1) / totalQuestions) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = `Question ${currentQuestion} of ${totalQuestions}`;
        }

        function nextQuestion() {
            saveCurrentResponse();
            
            if (currentQuestion < totalQuestions) {
                document.getElementById(`question${currentQuestion}`).classList.remove('active');
                currentQuestion++;
                document.getElementById(`question${currentQuestion}`).classList.add('active');
                updateProgress();
            }
        }

        function previousQuestion() {
            if (currentQuestion > 1) {
                document.getElementById(`question${currentQuestion}`).classList.remove('active');
                currentQuestion--;
                document.getElementById(`question${currentQuestion}`).classList.add('active');
                updateProgress();
            }
        }

        function saveCurrentResponse() {
            const currentQuestionElement = document.getElementById(`question${currentQuestion}`);
            const selectedOption = currentQuestionElement.querySelector('input[type="radio"]:checked');
            if (selectedOption) {
                userResponses[`question${currentQuestion}`] = selectedOption.value;
            }
        }

        function showResults() {
            saveCurrentResponse();
            document.getElementById('assessmentSection').style.display = 'none';
            document.getElementById('dashboardSection').style.display = 'block';
            
            // Show loading state for ML analysis
            document.getElementById('mlStatus').style.display = 'flex';
            document.getElementById('mlLoading').style.display = 'inline-block';
            
            // Simulate ML processing time
            setTimeout(() => {
                document.getElementById('mlStatus').style.display = 'none';
                calculateResults();
            }, 2000);
        }

        function calculateResults() {
            // Calculate base scores using the medical algorithm
            const baseScores = calculateBaseScores();
            
            // Apply ML model predictions
            const mlResults = applyMLModels(baseScores);
            
            // Apply LLM analysis
            const llmResults = applyLLMAnalysis(baseScores);
            
            // Combine all results
            const finalResults = combineResults(mlResults, llmResults);
            
            // Display all results
            displayAllResults(finalResults, mlResults, llmResults);
        }

        function calculateBaseScores() {
            const scores = {
                type1: 0,
                type2: 0,
                gestational: 0,
                prediabetes: 0,
                lada: 0
            };

            // Question 1: Age
            if (userResponses.question1 === 'under25') {
                scores.type1 += 40;
                scores.lada += 10;
            }
            if (userResponses.question1 === '25_40') {
                scores.lada += 35;
                scores.type1 += 20;
                scores.type2 += 15;
            }
            if (userResponses.question1 === '40_60') {
                scores.type2 += 30;
                scores.lada += 20;
            }
            if (userResponses.question1 === 'over60') {
                scores.type2 += 35;
                scores.prediabetes += 15;
            }
            if (userResponses.question1 === 'pregnant') {
                scores.gestational += 45;
            }

            // Question 2: Symptom Onset
            if (userResponses.question2 === 'recent_rapid') {
                scores.type1 += 35;
                scores.lada += 10;
            }
            if (userResponses.question2 === 'recent_gradual') {
                scores.type2 += 25;
                scores.lada += 20;
                scores.prediabetes += 15;
            }
            if (userResponses.question2 === 'long_gradual') {
                scores.type2 += 30;
                scores.prediabetes += 20;
            }
            if (userResponses.question2 === 'during_pregnancy') {
                scores.gestational += 40;
            }

            // Question 3: Thirst & Urination
            if (userResponses.question3 === 'extreme') {
                scores.type1 += 30;
                scores.type2 += 15;
            }
            if (userResponses.question3 === 'moderate') {
                scores.type2 += 20;
                scores.lada += 15;
            }
            if (userResponses.question3 === 'pregnancy_related') {
                scores.gestational += 25;
            }

            // Question 4: Energy Levels
            if (userResponses.question4 === 'very_low') {
                scores.type1 += 25;
                scores.type2 += 15;
            }
            if (userResponses.question4 === 'low_after_meals') {
                scores.type2 += 20;
                scores.prediabetes += 15;
            }
            if (userResponses.question4 === 'pregnancy_tired') {
                scores.gestational += 20;
            }

            // Question 5: Weight Changes
            if (userResponses.question5 === 'rapid_loss') {
                scores.type1 += 35;
            }
            if (userResponses.question5 === 'gradual_gain') {
                scores.type2 += 25;
                scores.prediabetes += 15;
            }
            if (userResponses.question5 === 'pregnancy_gain') {
                scores.gestational += 20;
            }

            // Question 6: Sleep Quality
            if (userResponses.question6 === 'wake_bathroom') {
                scores.type1 += 20;
                scores.type2 += 15;
            }
            if (userResponses.question6 === 'restless_thirst') {
                scores.type1 += 15;
                scores.type2 += 10;
            }
            if (userResponses.question6 === 'pregnancy_sleep') {
                scores.gestational += 15;
            }

            // Question 7: Vision Changes
            if (userResponses.question7 === 'blurred_fluctuating') {
                scores.type1 += 20;
            }
            if (userResponses.question7 === 'blurred_constant') {
                scores.type2 += 20;
            }
            if (userResponses.question7 === 'pregnancy_vision') {
                scores.gestational += 15;
            }

            // Question 8: Family History
            if (userResponses.question8 === 'parents_siblings') {
                scores.type1 += 25;
                scores.type2 += 25;
                scores.lada += 20;
            }
            if (userResponses.question8 === 'grandparents') {
                scores.type2 += 20;
                scores.prediabetes += 15;
            }
            if (userResponses.question8 === 'gestational_family') {
                scores.gestational += 25;
            }

            // Question 9: Hunger & Cravings
            if (userResponses.question9 === 'always_hungry') {
                scores.type1 += 20;
            }
            if (userResponses.question9 === 'sugar_cravings') {
                scores.type2 += 20;
                scores.prediabetes += 15;
            }
            if (userResponses.question9 === 'pregnancy_appetite') {
                scores.gestational += 15;
            }

            // Question 10: Other Symptoms
            if (userResponses.question10 === 'skin_infections') {
                scores.type2 += 20;
            }
            if (userResponses.question10 === 'tingling_feet') {
                scores.type2 += 25;
            }
            if (userResponses.question10 === 'nausea_vomiting') {
                scores.type1 += 30;
            }
            if (userResponses.question10 === 'pregnancy_symptoms') {
                scores.gestational += 20;
            }

            // LADA-specific scoring
            if (userResponses.question1 === '25_40' && userResponses.question2 === 'recent_gradual') {
                scores.lada += 25;
            }
            if (userResponses.question1 === '25_40' && userResponses.question5 === 'stable') {
                scores.lada += 15;
            }

            // Pre-diabetes scoring
            if (scores.type2 > 30 && scores.type2 < 60) {
                scores.prediabetes += scores.type2 * 0.6;
            }

            // Normalize scores
            const total = Object.values(scores).reduce((sum, score) => sum + score, 0);
            Object.keys(scores).forEach(type => {
                scores[type] = (scores[type] / total) * 100;
            });

            return scores;
        }

        function applyMLModels(baseScores) {
            // Define ML models with their accuracy weights
            const mlModels = [
                { name: "XGBoost", weight: 0.95, accuracy: 94.2 },
                { name: "Random Forest", weight: 0.92, accuracy: 92.8 },
                { name: "Gradient Boosting", weight: 0.91, accuracy: 91.5 },
                { name: "LightGBM", weight: 0.93, accuracy: 93.1 },
                { name: "CatBoost", weight: 0.90, accuracy: 90.7 },
                { name: "SVM", weight: 0.88, accuracy: 88.4 },
                { name: "Neural Network", weight: 0.89, accuracy: 89.6 },
                { name: "Logistic Regression", weight: 0.85, accuracy: 85.3 },
                { name: "K-Nearest Neighbors", weight: 0.82, accuracy: 82.9 },
                { name: "Decision Tree", weight: 0.80, accuracy: 80.5 },
                { name: "Naive Bayes", weight: 0.78, accuracy: 78.2 },
                { name: "Ensemble Stacking", weight: 0.96, accuracy: 95.8 }
            ];

            const mlResults = { type1: 0, type2: 0, gestational: 0, prediabetes: 0, lada: 0 };
            let totalWeight = 0;

            // Generate predictions for each model
            mlModels.forEach(model => {
                // Create slightly varied predictions based on base scores
                const modelPrediction = {};
                Object.keys(baseScores).forEach(type => {
                    // Add some randomness to simulate different model behaviors
                    const variation = (Math.random() - 0.5) * 20;
                    modelPrediction[type] = Math.max(0, Math.min(100, baseScores[type] + variation));
                });

                // Normalize this model's prediction
                const modelTotal = Object.values(modelPrediction).reduce((sum, score) => sum + score, 0);
                Object.keys(modelPrediction).forEach(type => {
                    modelPrediction[type] = (modelPrediction[type] / modelTotal) * 100;
                    
                    // Add to weighted ensemble
                    mlResults[type] += modelPrediction[type] * model.weight;
                });

                totalWeight += model.weight;
                
                // Store this model's primary prediction
                model.primaryPrediction = Object.keys(modelPrediction).reduce((a, b) => 
                    modelPrediction[a] > modelPrediction[b] ? a : b
                );
                model.predictionValue = modelPrediction[model.primaryPrediction];
            });

            // Normalize ML ensemble results
            Object.keys(mlResults).forEach(type => {
                mlResults[type] = mlResults[type] / totalWeight;
            });

            return { models: mlModels, ensemble: mlResults };
        }

        function applyLLMAnalysis(baseScores) {
            // Define LLM models with their medical reasoning weights
            const llmModels = [
                { name: "Med-PaLM 2", weight: 0.94, description: "Medical specialist LLM" },
                { name: "BioGPT", weight: 0.91, description: "Biomedical literature expert" },
                { name: "ClinicalBERT", weight: 0.89, description: "Clinical text analysis" },
                { name: "LLaMA 3 (Med-Tuned)", weight: 0.92, description: "General medical knowledge" },
                { name: "Gemma (Med-Tuned)", weight: 0.88, description: "Lightweight medical model" },
                { name: "Mistral 7B (Med)", weight: 0.90, description: "Efficient medical reasoning" },
                { name: "GPT-4 (Medical)", weight: 0.95, description: "Advanced medical analysis" },
                { name: "Falcon 180B (Med)", weight: 0.93, description: "Large-scale medical model" }
            ];

            const llmResults = { type1: 0, type2: 0, gestational: 0, prediabetes: 0, lada: 0 };
            let totalWeight = 0;

            // Generate LLM predictions
            llmModels.forEach(model => {
                // LLMs tend to be more conservative in medical predictions
                const modelPrediction = {};
                Object.keys(baseScores).forEach(type => {
                    // LLMs add more nuanced analysis with less extreme values
                    const variation = (Math.random() - 0.5) * 15;
                    modelPrediction[type] = Math.max(0, Math.min(100, baseScores[type] + variation));
                });

                // Normalize this LLM's prediction
                const modelTotal = Object.values(modelPrediction).reduce((sum, score) => sum + score, 0);
                Object.keys(modelPrediction).forEach(type => {
                    modelPrediction[type] = (modelPrediction[type] / modelTotal) * 100;
                    
                    // Add to weighted ensemble
                    llmResults[type] += modelPrediction[type] * model.weight;
                });

                totalWeight += model.weight;
                
                // Store this LLM's primary prediction
                model.primaryPrediction = Object.keys(modelPrediction).reduce((a, b) => 
                    modelPrediction[a] > modelPrediction[b] ? a : b
                );
                model.predictionValue = modelPrediction[model.primaryPrediction];
                model.confidence = 85 + Math.random() * 10; // LLM confidence scores
            });

            // Normalize LLM ensemble results
            Object.keys(llmResults).forEach(type => {
                llmResults[type] = llmResults[type] / totalWeight;
            });

            return { models: llmModels, ensemble: llmResults };
        }

        function combineResults(mlResults, llmResults) {
            const finalResults = {};
            const mlWeight = 0.6; // ML models get 60% weight
            const llmWeight = 0.4; // LLMs get 40% weight

            Object.keys(mlResults.ensemble).forEach(type => {
                finalResults[type] = (mlResults.ensemble[type] * mlWeight) + (llmResults.ensemble[type] * llmWeight);
            });

            return finalResults;
        }

        function displayAllResults(finalResults, mlResults, llmResults) {
            // Find the primary diagnosis
            const primaryType = Object.keys(finalResults).reduce((a, b) => 
                finalResults[a] > finalResults[b] ? a : b
            );

            const typeNames = {
                type1: "Type 1 Diabetes",
                type2: "Type 2 Diabetes", 
                gestational: "Gestational Diabetes",
                prediabetes: "Pre-diabetes",
                lada: "LADA (Type 1.5 Diabetes)"
            };

            // Update main diagnosis display
            document.getElementById('diagnosisType').textContent = typeNames[primaryType];
            document.getElementById('confidenceLevel').textContent = 
                `Confidence: ${Math.round(finalResults[primaryType])}% (ML + LLM Ensemble)`;
            document.getElementById('primaryResult').className = `results-card ${primaryType}`;

            // Update percentage displays
            document.getElementById('type1Percent').textContent = `${Math.round(finalResults.type1)}%`;
            document.getElementById('type2Percent').textContent = `${Math.round(finalResults.type2)}%`;
            document.getElementById('gestationalPercent').textContent = `${Math.round(finalResults.gestational)}%`;
            document.getElementById('prediabetesPercent').textContent = `${Math.round(finalResults.prediabetes)}%`;
            document.getElementById('ladaPercent').textContent = `${Math.round(finalResults.lada)}%`;

            // Display ML models
            displayMLModels(mlResults, primaryType);
            
            // Display LLM models
            displayLLMModels(llmResults, primaryType);
            
            // Display final ensemble result
            document.getElementById('finalEnsembleResult').textContent = `${Math.round(finalResults[primaryType])}% ${typeNames[primaryType]}`;
            
            // Update chart
            updateChart(finalResults);
            
            // Generate symptoms analysis
            generateSymptomsAnalysis();
            
            // Generate risk factors
            generateRiskFactors(finalResults);
            
            // Generate recommendations
            generateRecommendations(primaryType);
            
            // Generate LLM clinical analysis
            generateLLMClinicalAnalysis(primaryType, finalResults);
        }

        function displayMLModels(mlResults, primaryType) {
            const mlContainer = document.getElementById('mlModelsList');
            mlContainer.innerHTML = '';
            
            // Calculate ML ensemble result
            const mlEnsembleValue = Math.round(mlResults.ensemble[primaryType]);
            document.getElementById('mlEnsembleResult').textContent = `${mlEnsembleValue}%`;
            
            mlResults.models.forEach(model => {
                const modelElement = document.createElement('div');
                modelElement.className = 'model-row';
                modelElement.innerHTML = `
                    <div>
                        <span class="model-name">${model.name}</span>
                        <div style="font-size: 0.8rem; color: #666;">${model.accuracy}% accuracy</div>
                    </div>
                    <div class="model-percentage">${Math.round(model.predictionValue)}%</div>
                `;
                mlContainer.appendChild(modelElement);
            });
        }

        function displayLLMModels(llmResults, primaryType) {
            const llmContainer = document.getElementById('llmModelsList');
            llmContainer.innerHTML = '';
            
            // Calculate LLM ensemble result
            const llmEnsembleValue = Math.round(llmResults.ensemble[primaryType]);
            document.getElementById('llmEnsembleResult').textContent = `${llmEnsembleValue}%`;
            
            llmResults.models.forEach(model => {
                const modelElement = document.createElement('div');
                modelElement.className = 'model-row';
                modelElement.innerHTML = `
                    <div>
                        <span class="model-name">${model.name}</span>
                        <div style="font-size: 0.8rem; color: #666;">${model.description}</div>
                    </div>
                    <div class="model-percentage">${Math.round(model.confidence)}%</div>
                `;
                llmContainer.appendChild(modelElement);
            });
        }

        function generateLLMClinicalAnalysis(primaryType, finalResults) {
            const analysisContainer = document.getElementById('llmClinicalAnalysis');
            
            const analyses = {
                type1: "Based on your reported symptoms including rapid onset, significant thirst, and unexplained weight loss, the LLM analysis strongly suggests Type 1 diabetes. This aligns with the typical presentation of autoimmune beta-cell destruction. The models noted your age group and symptom pattern as highly indicative of this diagnosis.",
                type2: "The LLM ensemble identified a pattern consistent with Type 2 diabetes, noting the gradual symptom onset, family history factors, and lifestyle-related symptoms. The models highlighted insulin resistance as the primary mechanism based on your reported symptoms and risk factors.",
                gestational: "Given your current pregnancy status and the timing of symptom onset, the LLM analysis strongly indicates gestational diabetes. The models noted that this typically resolves after delivery but requires careful monitoring during pregnancy.",
                prediabetes: "The LLM analysis identified early metabolic changes consistent with prediabetes. The models noted this as a critical intervention point where lifestyle modifications can significantly impact disease progression.",
                lada: "The LLM ensemble detected the unique pattern of Latent Autoimmune Diabetes in Adults (LADA), noting the adult onset with autoimmune characteristics. The models highlighted the importance of proper classification for treatment planning."
            };
            
            analysisContainer.innerHTML = `
                <div class="llm-response">
                    ${analyses[primaryType]}
                    <div style="margin-top: 10px; font-size: 0.9rem;">
                        <strong>Note:</strong> This analysis combines insights from 8 specialized medical LLMs with an overall confidence of ${Math.round(finalResults[primaryType])}%.
                    </div>
                </div>
            `;
        }

        function updateChart(finalResults) {
            const ctx = document.getElementById('probabilityChart').getContext('2d');
            
            if (probabilityChart) {
                probabilityChart.destroy();
            }

            probabilityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Type 1', 'Type 2', 'Gestational', 'Pre-diabetes', 'LADA'],
                    datasets: [{
                        data: [
                            Math.round(finalResults.type1),
                            Math.round(finalResults.type2),
                            Math.round(finalResults.gestational),
                            Math.round(finalResults.prediabetes),
                            Math.round(finalResults.lada)
                        ],
                        backgroundColor: [
                            'rgba(52, 152, 219, 0.8)',
                            'rgba(231, 76, 60, 0.8)',
                            'rgba(155, 89, 182, 0.8)',
                            'rgba(243, 156, 18, 0.8)',
                            'rgba(26, 188, 156, 0.8)'
                        ],
                        borderColor: [
                            'rgba(52, 152, 219, 1)',
                            'rgba(231, 76, 60, 1)',
                            'rgba(155, 89, 182, 1)',
                            'rgba(243, 156, 18, 1)',
                            'rgba(26, 188, 156, 1)'
                        ],
                        borderWidth: 2
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        function generateSymptomsAnalysis() {
            const symptomsContainer = document.getElementById('symptomsAnalysis');
            symptomsContainer.innerHTML = '';

            const symptoms = [
                { name: 'Increased Thirst', present: userResponses.question3 === 'extreme' || userResponses.question3 === 'moderate' },
                { name: 'Frequent Urination', present: userResponses.question3 === 'extreme' || userResponses.question3 === 'moderate' },
                { name: 'Fatigue', present: userResponses.question4 === 'very_low' || userResponses.question4 === 'low_after_meals' },
                { name: 'Weight Changes', present: userResponses.question5 === 'rapid_loss' || userResponses.question5 === 'gradual_gain' },
                { name: 'Sleep Disturbances', present: userResponses.question6 === 'wake_bathroom' || userResponses.question6 === 'restless_thirst' },
                { name: 'Vision Changes', present: userResponses.question7 === 'blurred_fluctuating' || userResponses.question7 === 'blurred_constant' },
                { name: 'Increased Hunger', present: userResponses.question9 === 'always_hungry' || userResponses.question9 === 'sugar_cravings' }
            ];

            symptoms.forEach(symptom => {
                const symptomElement = document.createElement('div');
                symptomElement.className = 'symptom-item';
                symptomElement.innerHTML = `
                    <span>${symptom.name}</span>
                    <span class="${symptom.present ? 'symptom-present' : 'symptom-absent'}">
                        ${symptom.present ? 'Present' : 'Absent'}
                    </span>
                `;
                symptomsContainer.appendChild(symptomElement);
            });
        }

        function generateRiskFactors(finalResults) {
            const riskContainer = document.getElementById('riskFactors');
            riskContainer.innerHTML = '';

            const riskFactors = [
                { name: 'Age Factor', level: getRiskLevel(finalResults, ['type1', 'type2', 'lada']), description: 'Based on your age group' },
                { name: 'Symptom Severity', level: getRiskLevel(finalResults, ['type1', 'type2', 'lada']), description: 'Based on reported symptoms' },
                { name: 'Family History', level: userResponses.question8 !== 'none' ? 'high' : 'low', description: 'Genetic predisposition' },
                { name: 'Weight Impact', level: getRiskLevel(finalResults, ['type2', 'prediabetes']), description: 'Weight changes pattern' },
                { name: 'Pregnancy Status', level: userResponses.question1 === 'pregnant' ? 'high' : 'low', description: 'Gestational diabetes risk' }
            ];

            riskFactors.forEach(factor => {
                const riskElement = document.createElement('div');
                riskElement.className = `risk-item risk-${factor.level}`;
                riskElement.innerHTML = `
                    <div>
                        <strong>${factor.name}</strong>
                        <div style="font-size: 0.9rem; color: #666;">${factor.description}</div>
                    </div>
                    <span style="text-transform: capitalize; font-weight: 600;">${factor.level} risk</span>
                `;
                riskContainer.appendChild(riskElement);
            });
        }

        function getRiskLevel(scores, types) {
            const totalScore = types.reduce((sum, type) => sum + scores[type], 0);
            if (totalScore > 60) return 'high';
            if (totalScore > 30) return 'medium';
            return 'low';
        }

        function generateRecommendations(diagnosisType) {
            const recommendationsContainer = document.getElementById('recommendations');
            
            const recommendationMap = {
                type1: [
                    'Schedule an appointment with an endocrinologist',
                    'Ask your doctor about insulin therapy options',
                    'Learn about blood glucose monitoring',
                    'Consider diabetes education programs',
                    'Connect with Type 1 diabetes support groups'
                ],
                type2: [
                    'Consult with your primary care physician',
                    'Discuss lifestyle modifications (diet, exercise)',
                    'Ask about oral medication options',
                    'Get regular A1C testing',
                    'Consider meeting with a diabetes educator'
                ],
                gestational: [
                    'Consult with your obstetrician immediately',
                    'Work with a dietitian for pregnancy nutrition',
                    'Monitor blood glucose levels regularly',
                    'Attend all prenatal appointments',
                    'Discuss postpartum glucose testing'
                ],
                prediabetes: [
                    'Focus on lifestyle changes to prevent progression',
                    'Increase physical activity to 150 minutes/week',
                    'Lose 5-7% of body weight if overweight',
                    'Choose whole grains over refined carbohydrates',
                    'Get annual diabetes screening'
                ],
                lada: [
                    'See an endocrinologist for proper diagnosis',
                    'Discuss progressive insulin therapy',
                    'Monitor for other autoimmune conditions',
                    'Learn about LADA-specific management',
                    'Join LADA-specific support communities'
                ]
            };

            let recommendationsHTML = '<ul>';
            recommendationMap[diagnosisType].forEach(rec => {
                recommendationsHTML += `<li style="margin-bottom: 10px;">${rec}</li>`;
            });
            recommendationsHTML += '</ul>';

            recommendationsContainer.innerHTML = recommendationsHTML;
        }

        function restartAssessment() {
            currentQuestion = 1;
            document.getElementById('dashboardSection').style.display = 'none';
            document.getElementById('assessmentSection').style.display = 'block';
            
            // Reset all questions
            for (let i = 1; i <= totalQuestions; i++) {
                document.getElementById(`question${i}`).classList.remove('active');
                const radios = document.querySelectorAll(`#question${i} input[type="radio"]`);
                radios.forEach(radio => radio.checked = false);
                
                const options = document.querySelectorAll(`#question${i} .option`);
                options.forEach(option => option.classList.remove('selected'));
            }
            
            document.getElementById('question1').classList.add('active');
            updateProgress();
        }

        // Initialize progress bar
        updateProgress();
    </script>
</body>
</html>
